<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë¥´íƒ„ì´ ë‹¬ë¦¬ê¸° ê²Œì„ - ì‹¤ìŠµ ì‹œí—˜ì§€</title>
    <!--
    ==============================
    ====== Customizable CSS ======
    CSS ë³€ìˆ˜ ì‚¬ìš© ëŒ€ì‹  ì§ì ‘ ê°’ì„ ë„£ì–´ ìŠ¤íƒ€ì¼ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ==============================
  -->
    <style>
        /* body styling */
        body {
            background-color: #f0f0f0;
            /* ë°°ê²½ ìƒ‰ìƒ */
            font-size: 16px;
            /* ë³¸ë¬¸ í°íŠ¸ í¬ê¸° */
            line-height: 1.6;
            /* ë³¸ë¬¸ ì¤„ ë†’ì´ */
            margin: 0;
            padding: 20px;
            color: #333;
            /* ë³¸ë¬¸ í…ìŠ¤íŠ¸ ìƒ‰ */
        }

        /* canvas ë° í…ìŠ¤íŠ¸ ìš”ì†Œ */
        canvas {
            display: block;
            margin: 0 auto;
            background-color: #fff;
            /* ìº”ë²„ìŠ¤ ë°°ê²½ */
            border: 1px solid #ccc;
            /* ìº”ë²„ìŠ¤ í…Œë‘ë¦¬ */
            border-radius: 12px;
            /* ìº”ë²„ìŠ¤ ë‘¥ê·¼ ëª¨ì„œë¦¬ */
        }

        #subtitle {
            font-size: 20px;
            /* ë¶€ì œëª© í°íŠ¸ í¬ê¸° */
            text-align: center;
        }

        #score {
            font-size: 40px;
            /* ì ìˆ˜ í°íŠ¸ í¬ê¸° */
            text-align: center;
            margin-top: 20px;
            font-weight: bold;
        }
    </style>

    <!--
    ======================================
    ====== Customizable JS Settings ======
    ìœ„ ìƒìˆ˜ë“¤ì„ ìˆ˜ì •í•˜ì—¬ ê²Œì„ ë™ì‘ì„ ì»¤ìŠ¤í…€í•˜ì„¸ìš”.
    ======================================
  -->
    <script>
        // ìº”ë²„ìŠ¤ í¬ê¸°
        const CANVAS_WIDTH = 800;     // ìº”ë²„ìŠ¤ ê°€ë¡œ í¬ê¸°
        const CANVAS_HEIGHT = 500;    // ìº”ë²„ìŠ¤ ì„¸ë¡œ í¬ê¸°

        // ë°°ê²½ ìŠ¤í¬ë¡¤ ì†ë„
        const BG_MOVING_SPEED = 3;

        // ëŸ¬ë„ˆ(ë¥´íƒ„ì´) ì„¤ì •
        const RUNNER_WIDTH = 100;
        const RUNNER_HEIGHT = 100;
        const RUNNER_START_X = 10;
        const RUNNER_START_Y = 400;

        // ì í”„ ì„¤ì •
        const JUMP_SPEED = 3;         // ì í”„ ì‹œ Yê°’ ë³€í™”ëŸ‰
        const MAX_JUMP_HEIGHT = 20;   // ìµœëŒ€ ì í”„ ê³ ì • Yìœ„ì¹˜

        // ì¥ì• ë¬¼ ì„¤ì •
        const OBSTACLE_WIDTH = 50;
        const OBSTACLE_HEIGHT = 50;
        const OBSTACLE_FREQUENCY = 90; // í”„ë ˆì„ë§ˆë‹¤ ìƒì„± ë¹ˆë„
        const OBSTACLE_SPEED = 4;
        const SCORE_PER_OBSTACLE = 10; // ì¥ì• ë¬¼ ë‹¹ ì ìˆ˜
        // ìŒì› ë° ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì •
        const ASSETS = {
            sounds: {
                jump: './sounds/jump.mp3',
                bgm: './sounds/bgm.mp3',
                score: './sounds/score.mp3',
                defeat: './sounds/defeat1.mp3'
            },
            images: {
                background: './images/background.png',
                gameStart: './images/gamestart.png',
                gameOver: './images/gameover.png',
                restart: './images/restart.png',
                runnerA: './images/rtan_running_a.png',
                runnerB: './images/rtan_running_b.png',
                runnerCrash: './images/rtan_crash.png',
                obstacle: './images/obstacle1.png'
            }
        };

        // ë°”í†µ ìƒ‰ìƒ ì»¤ìŠ¤í…€
        const BATON_COLORS = {
            default: 'green',
            alternate: 'orange'
        };
    </script>

    <!--
    ==================================
    ====== Core Game Code (No Edits) ======
    ì•„ë˜ë¶€í„°ëŠ” ì‹œí—˜ì§€ ê¸°ëŠ¥ ê²€ì‚¬ìš© ë¡œì§ì´ë¯€ë¡œ ìˆ˜ì •í•˜ì§€ ë§ê³  í•™ìŠµìš©ìœ¼ë¡œë§Œ í™œìš©í•˜ì„¸ìš”.
    ==================================
  -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('canvas');
            canvas.width = CANVAS_WIDTH;
            canvas.height = CANVAS_HEIGHT;
            const ctx = canvas.getContext('2d');

            let gameStarted = false;
            let gameOver = false;
            let timer = 0;
            let score = 0;
            let jump = false;
            let bgX = 0;
            const scoreText = document.getElementById('score');

            // ì˜¤ë””ì˜¤ ë¡œë“œ
            const jumpSound = new Audio(ASSETS.sounds.jump);
            const bgmSound = new Audio(ASSETS.sounds.bgm);
            const scoreSound = new Audio(ASSETS.sounds.score);
            const defeatSound = new Audio(ASSETS.sounds.defeat);

            // ì´ë¯¸ì§€ ë¡œë“œ
            const bgImage = new Image(); bgImage.src = ASSETS.images.background;
            const startImage = new Image(); startImage.src = ASSETS.images.gameStart;
            const gameoverImage = new Image(); gameoverImage.src = ASSETS.images.gameOver;
            const restartImage = new Image(); restartImage.src = ASSETS.images.restart;
            const runnerAImage = new Image(); runnerAImage.src = ASSETS.images.runnerA;
            const runnerBImage = new Image(); runnerBImage.src = ASSETS.images.runnerB;
            const crashImage = new Image(); crashImage.src = ASSETS.images.runnerCrash;
            const obstacleImage = new Image(); obstacleImage.src = ASSETS.images.obstacle;

            const runner = {
                x: RUNNER_START_X,
                y: RUNNER_START_Y,
                width: RUNNER_WIDTH,
                height: RUNNER_HEIGHT,
                draw() {
                    if (gameOver) {
                        ctx.drawImage(crashImage, this.x, this.y, this.width, this.height);
                    } else {
                        const frame = (timer % 60 > 30) ? runnerAImage : runnerBImage;
                        ctx.drawImage(frame, this.x, this.y, this.width, this.height);
                    }
                }
            };

            class Obstacle {
                constructor() {
                    this.x = CANVAS_WIDTH;
                    this.y = Math.floor(Math.random() * (CANVAS_HEIGHT - OBSTACLE_HEIGHT - 30)) + 30;
                    this.width = OBSTACLE_WIDTH;
                    this.height = OBSTACLE_HEIGHT;
                }
                draw() {
                    ctx.drawImage(obstacleImage, this.x, this.y, this.width, this.height);
                }
            }

            const obstacles = [];

            function backgroundImg(x) {
                ctx.drawImage(bgImage, x, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            }

            function drawStartScreen() {
                ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                backgroundImg(0);
                const w = 473, h = 316;
                ctx.drawImage(startImage, (CANVAS_WIDTH - w) / 2, (CANVAS_HEIGHT - h) / 2, w, h);
            }

            function drawGameOverScreen() {
                ctx.drawImage(gameoverImage, (CANVAS_WIDTH - 200) / 2, (CANVAS_HEIGHT - 100) / 2, 200, 100);
                ctx.drawImage(restartImage, (CANVAS_WIDTH - 100) / 2, (CANVAS_HEIGHT + 50) / 2, 100, 50);
            }

            Promise.all([
                new Promise(r => bgImage.onload = r),
                new Promise(r => startImage.onload = r)
            ]).then(drawStartScreen);

            function isCollision(a, b) {
                return !(a.x > b.x + b.width || a.x + a.width < b.x || a.y > b.y + b.height || a.y + a.height < b.y);
            }

            function animate() {
                if (gameOver) {
                    drawGameOverScreen();
                    return;
                }
                requestAnimationFrame(animate);
                ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                timer++;

                backgroundImg(bgX);
                backgroundImg(bgX + CANVAS_WIDTH);
                bgX -= BG_MOVING_SPEED;
                if (bgX < -CANVAS_WIDTH) bgX = 0;
                bgmSound.play();

                if (timer % OBSTACLE_FREQUENCY === 0) obstacles.push(new Obstacle());
                obstacles.forEach((obs, idx) => {
                    obs.draw(); obs.x -= OBSTACLE_SPEED;
                    if (obs.x < -OBSTACLE_WIDTH) {
                        obstacles.splice(idx, 1);
                        score += SCORE_PER_OBSTACLE;
                        scoreText.textContent = 'í˜„ì¬ì ìˆ˜: ' + score;
                        scoreSound.currentTime = 0;
                        scoreSound.play();
                    }
                    if (isCollision(runner, obs)) {
                        gameOver = true;
                        bgmSound.pause();
                        defeatSound.play();
                    }
                });

                runner.draw();
                if (jump) {
                    runner.y = Math.max(MAX_JUMP_HEIGHT, runner.y - JUMP_SPEED);
                } else {
                    runner.y = Math.min(RUNNER_START_Y, runner.y + JUMP_SPEED);
                }
            }

            // ì´ë²¤íŠ¸ ì²˜ë¦¬
            document.addEventListener('keydown', e => {
                if (e.code === 'Space' && !jump) {
                    jump = true;
                    jumpSound.play();
                }
            });
            document.addEventListener('keyup', e => {
                if (e.code === 'Space') jump = false;
            });
            canvas.addEventListener('click', e => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                if (!gameStarted) {
                    gameStarted = true;
                    animate();
                } else if (gameOver && x > (CANVAS_WIDTH - 100) / 2 && x < (CANVAS_WIDTH + 100) / 2 && y > (CANVAS_HEIGHT + 50) / 2 && y < (CANVAS_HEIGHT + 100) / 2) {
                    location.reload();
                }
            });
            canvas.addEventListener('mousemove', e => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                if ((!gameStarted) || (gameOver && x > (CANVAS_WIDTH - 100) / 2 && x < (CANVAS_WIDTH + 100) / 2 && y > (CANVAS_HEIGHT + 50) / 2 && y < (CANVAS_HEIGHT + 100) / 2)) {
                    canvas.style.cursor = 'pointer';
                } else {
                    canvas.style.cursor = 'default';
                }
            });
        });
    </script>
</head>

<body>
    <p id="subtitle">ë¥´íƒ„ì´ì™€ í•¨ê»˜ ìµœê³ ì ì„ í–¥í•˜ì—¬!! ğŸ˜€</p>
    <p id="score">í˜„ì¬ì ìˆ˜: 0</p>
    <main>
        <canvas id="canvas"></canvas>
    </main>
</body>

</html>